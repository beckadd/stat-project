---
title: "An Analysis of African Systemic Crises"
author: "Beck Addison, Jerry Lin, Isabella Swigart, Emma Hirschkop"
date: "12/3/2019"
output: github_document
---

Your data analysis goes here!
```{r load-packages}
#install.packages("countrycode") - already installed
#install.packages("infer")
library(infer)
library(tidyverse)
library(countrycode)

```

```{r load-data}
africa <- read_csv("../data/african_crises.csv")
global <- read_csv("../data/global_crisis_data.csv")
gdps <- read_csv("../data/world_gdp_data.csv")
```

Our analysis begins with two datasets: our original African economic crises dataset, which contains numerical variables like inflation rate, exchange rate against the US dollar, and debt vs. GDP ratio. Another helpful variable to analyze would be each country's GDP, so we downloaded world GDP data from the World Bank, and joined this data with our Africa dataset.
```{r data-cleaning}
gdps <- gdps %>%
  pivot_longer(
    cols = c(
      -`Country Name`,
      -`Country Code`,
      -`Indicator Name`,
      -`Indicator Code`),
    names_to = "year"
  ) %>%
  rename(
    cc3 = `Country Code`,
    indicator_code = `Indicator Code`,
    indicator_name = `Indicator Name`,
    country = `Country Name`,
    gdp = value
    )

african_gdps <- gdps %>%
  merge(., africa, by = c("country","cc3","year"))

global <- global[-1,] %>%
  select(-`<`) %>%
  rename(
    case = Case,
    cc3 = CC3,
    country = Country,
    year = Year,
    banking_crisis = `Banking Crisis`,
    systemic_crisis = `Systemic Crisis`,
    gold_standard = `Gold Standard`,
    nat_currency = `national currency`,
    sov_ext_debt = 
    `SOVEREIGN EXTERNAL DEBT 1: DEFAULT and RESTRUCTURINGS, 1800-2012--Does not include defaults on WWI debt to United States and United Kingdom and post-1975 defaults on Official External Creditors`,
    sov_ext_debt_post1975 = `SOVEREIGN EXTERNAL DEBT 2: DEFAULT and RESTRUCTURINGS, 1800-2012--Does not include defaults on WWI debt to United States and United Kingdom but includes post-1975 defaults on Official External Creditors`,
    exc_primary = `exch_primary source code`,
    domest_debt_default = `Domestic_Debt_In_Default`,
    domest_debt_notes = `Domestic_Debt_ Notes/Sources`,
    default_ext_notes = `Defaults_External_Notes`,
    gdp_weighted_default = `GDP_Weighted_default`,
    inflat_aver_consumer_prices = `Inflation, Annual percentages of average consumer prices`,
    curr_crises = `Currency Crises`,
    independence = `Independence`,
    inflat_crises = `Inflation Crises`
) %>%
  mutate(
    banking_crisis = as.logical(as.numeric(
      banking_crisis
      )),
    systemic_crisis = as.logical(as.numeric(
      systemic_crisis
    )),
    gold_standard = as.logical(as.numeric(
      gold_standard
    )),
    domest_debt_default = as.logical(as.numeric(
      domest_debt_default
    )),
    independence = as.logical(as.numeric(
      independence
    )),
    curr_crises = as.logical(as.numeric(
      curr_crises
    )),
    inflat_crises = as.logical(as.numeric(
      inflat_crises
    ))
  )
```

## Question 2: Hypothesis Testing

#### Was an economic crisis more likely following n years after decolonization?

Consider the following: for each country, we'll determine how many years after independence a country will typically experience its next crisis.
```{r independence}
output <- tibble(country = distinct(africa, country)$country)
output$independence_year <- africa %>%
  filter(independence == 1) %>%
  group_by(country) %>%
  filter(row_number()==1) %>%
  ungroup() %>%
  select(year)
  
output$crisis_year <- africa %>%
  filter(independence == 1) %>%
  group_by(country) %>%
  filter(banking_crisis == "crisis") %>%
  filter(row_number() == 1) %>%
  ungroup() %>%
  select(year)
output <- output %>%
  mutate(difference = (crisis_year$year - independence_year$year))
ggplot(data = output, mapping = aes(y = difference)) +
  geom_boxplot() + 
  labs(
    title = "What's the typical amount of years between a country 
    achieving independence and its next financial crisis?",
    y = "Number of Years")
output %>%
  summarise(IQR = IQR(difference), median = median(difference), mean = mean(difference))
```
We see that the median amount of years a country will first encounter a banking crisis after they achieve independence is about 30 years, with an interquartile range of 11 years and a mean of 31.3 years.

We're really interested in the economic stability of independent vs. colonized African countries. In particular, we're wondering if post-independence African countries see a higher proportion of systemic crises (per year) compared to before independence. Let's examine it: 

```{r prop-crisis}
crisis_prop <- africa %>%
  group_by(country, independence) %>%
  summarise(crisis_prop = sum(systemic_crisis)/n())
crisis_prop
overall_crisis_prop <- africa %>%
  group_by(independence) %>%
  summarise(overall_crisis_prop = sum(systemic_crisis)/n())
overall_crisis_prop
```

Based on our sample, we see that on average, there is a 0.42% chance of a systemic crisis occurring in any given year for a non-independent country, while there is a 9.85% chance of a systemic crisis occurring in any given year for a independent country. The difference in proportions is 0.094320737. 

We'd like to conduct a hypothesis test to see if there is a difference in proportions of systemic crises between independent and non-independent countries across all African countries. Our null hypothesis is that the proportion of systemic crises between independent and non-independent African countries is the same; the observed difference is due to chance Our alternative hypothesis is that the proportion of systemic crises between independent and non-independent African countries is different. 

Since we're testing for independence, we'll use permute. We'll modify our dataset slightly by factoring success into a categorical variable so that it'll work nicely with infer.

Before we run the hypothesis test, we need to quickly factor systemic_crisis to be a categorical variable:
```{r systemic-categorical}
fct_africa <- africa %>%
  mutate(systemic_crisis = factor(systemic_crisis)) %>%
  mutate(independence = factor(independence))
```

```{r crisis-prop-diff}
set.seed(1)
null_dist <- fct_africa %>%
  specify(response = systemic_crisis, explanatory = independence, success = "1") %>%
  hypothesize(null = "independence") %>%
  generate(1000, type = "permute") %>%
  calculate(stat = "diff in props", 
            order = c("1", "0"))
visualize(null_dist)
get_p_value(null_dist, obs_stat = 0.094320737, direction = "two_sided")
```

Since our p-value of 0 is less than our significance level of 0.05, we reject the null hypothesis. The data provides convincing evidence that there is a difference in the proportion of systemic crises between non-independent and independent African countries.


#### Is there a difference between GDP and systemic crises in North African and sub-Saharan African countries?

We're interested in seeing if there's a noticeable difference in economic stability and prosperity between North African and sub-Saharan African countries. 

To answer this question, we need to label North African and sub-Saharan countries in our Africa dataset. 
``` {r label-region}
fct_africa <- fct_africa %>%
  mutate(region = case_when(
    country == "Algeria" ~ "n",
    country == "Angola" ~ "s",
    country == "Central African Republic" ~ "s",
    country == "Egypt" ~ "n",
    country == "Ivory Coast" ~ "s",
    country == "Kenya" ~ "s",
    country == "Mauritius" ~ "s",
    country == "Morocco" ~ "n",
    country == "Nigeria" ~ "s",
    country == "South Africa" ~ "s",
    country == "Tunisia" ~ "n",
    country == "Zambia" ~ "s",
    country == "Zimbabwe" ~ "s"
  ))
africa <- africa %>%
  mutate(region = case_when(
    country == "Algeria" ~ "n",
    country == "Angola" ~ "s",
    country == "Central African Republic" ~ "s",
    country == "Egypt" ~ "n",
    country == "Ivory Coast" ~ "s",
    country == "Kenya" ~ "s",
    country == "Mauritius" ~ "s",
    country == "Morocco" ~ "n",
    country == "Nigeria" ~ "s",
    country == "South Africa" ~ "s",
    country == "Tunisia" ~ "n",
    country == "Zambia" ~ "s",
    country == "Zimbabwe" ~ "s"
  ))
african_gdps <- african_gdps %>%
  mutate(region = case_when(
    country == "Algeria" ~ "n",
    country == "Angola" ~ "s",
    country == "Central African Republic" ~ "s",
    country == "Egypt" ~ "n",
    country == "Ivory Coast" ~ "s",
    country == "Kenya" ~ "s",
    country == "Mauritius" ~ "s",
    country == "Morocco" ~ "n",
    country == "Nigeria" ~ "s",
    country == "South Africa" ~ "s",
    country == "Tunisia" ~ "n",
    country == "Zambia" ~ "s",
    country == "Zimbabwe" ~ "s"
  ))
```

Let's calculate the median GDP for North African and sub-Saharan countries.

When calculating GDP by region, we'll use 2014 GDP data since it's recent and available for all 13 African countries in our dataset. 
```{r GDP-region-split}
african_gdps %>%
  filter(year == 2014) %>%
  group_by(region) %>%
  summarise(avg_gdp = median(gdp))
```
The average GDP for North African countries is \$110,081,000,000; the average GDP for sub-Saharan countries is \$44,299,338,704. The difference is $65,781,661,296.

The first research question we'll ask is: is there a difference in median GDP among all North African and sub-Saharan countries?

Our null hypothesis is that the GDP of North African and sub-Saharan countries is the same; the observed difference is due to chance. Our alternative hypothesis is that the GDP of independent and non-independent African countries is different. 

Since we're testing for independence, we'll use permute.
```{r gdp-prop-diff}
set.seed(1)
gdp_2014 <- african_gdps %>%
  filter(year == 2014)

null_dist2 <- gdp_2014 %>%
  specify(response = gdp, explanatory = region) %>%
  hypothesize(null = "independence") %>%
  generate(1000, type = "permute") %>%
  calculate(stat = "diff in medians", 
            order = c("n", "s"))
visualize(null_dist2)
get_p_value(null_dist2, obs_stat = 65781661296, direction = "two_sided")
```

Since our p-value of 0.528 is greater than our significance level of 0.05, we fail to reject the null hypothesis. The data does not provide convincing evidence that there is a difference between the median GDP of North African countries comapred to sub-Saharan countries.

Next, let's calculate the proportion of systemic crises for North African and sub-Saharan countries. 

```{r systemic-crisis-by-region}
africa %>%
  group_by(region) %>%
  summarise(overall_crisis_prop = sum(systemic_crisis)/n())
```
The proportion of systemic crises for North African countries is 0.0436; the proportion of systemic crises for sub-Saharan countries is 0.0971. The difference is 0.0535702.

The second research question we'll ask is: is there a difference in proportion of systemic crises between all North African and sub-Saharan countries?

Our null hypothesis is that the proportion of systemic crises between North African and sub-Saharan countries is the same; the observed difference is due to chance. Our alternative hypothesis is that the proportion of systemic crises between North African and sub-Saharan countries is different. 

Since we're testing for independence, we'll use permute.
```{r region-prop-diff}
set.seed(1)
null_dist3 <- fct_africa %>%
  specify(response = systemic_crisis, explanatory = region, success = "1") %>%
  hypothesize(null = "independence") %>%
  generate(1000, type = "permute") %>%
  calculate(stat = "diff in props", 
            order = c("n", "s"))
visualize(null_dist3)
get_p_value(null_dist3, obs_stat = 0.0535702, direction = "two_sided")
```

Since our p-value of 0 is less than the significance level of 0.05, we reject the null hypothesis. The data provides convincing evidence that there is a difference in proportion of systemic crises between North African countries and sub-Saharan countries.


