---
title: "An Analysis of African Systemic Crises"
author: "Beck Addison, Jerry Lin, Isabella Swigart, Emma Hirschkop"
date: "12/3/2019"
output: github_document
---

Your data analysis goes here!
```{r load-packages}
#install.packages("countrycode") - already installed
#install.packages("infer")
library(infer)
library(tidyverse)
library(countrycode)

```

```{r load-data}
africa <- read_csv("../data/african_crises.csv")
global <- read_csv("../data/global_crisis_data.csv")
gdps <- read_csv("../data/world_gdp_data.csv")
```

Our analysis begins with two datasets: our original African economic crises dataset, which contains numerical variables like inflation rate, exchange rate against the US dollar, and debt vs. GDP ratio. Another helpful variable to analyze would be each country's GDP, so we downloaded world GDP data from the World Bank, and joined this data with our Africa dataset.
```{r data-cleaning}
gdps <- gdps %>%
  pivot_longer(
    cols = c(
      -`Country Name`,
      -`Country Code`,
      -`Indicator Name`,
      -`Indicator Code`),
    names_to = "year"
  ) %>%
  rename(
    cc3 = `Country Code`,
    indicator_code = `Indicator Code`,
    indicator_name = `Indicator Name`,
    country = `Country Name`,
    gdp = value
    )

african_gdps <- gdps %>%
  merge(., africa, by = c("country","cc3","year"))

global <- global[-1,] %>%
  select(-`<`) %>%
  rename(
    case = Case,
    cc3 = CC3,
    country = Country,
    year = Year,
    banking_crisis = `Banking Crisis`,
    systemic_crisis = `Systemic Crisis`,
    gold_standard = `Gold Standard`,
    nat_currency = `national currency`,
    sov_ext_debt = 
    `SOVEREIGN EXTERNAL DEBT 1: DEFAULT and RESTRUCTURINGS, 1800-2012--Does not include defaults on WWI debt to United States and United Kingdom and post-1975 defaults on Official External Creditors`,
    sov_ext_debt_post1975 = `SOVEREIGN EXTERNAL DEBT 2: DEFAULT and RESTRUCTURINGS, 1800-2012--Does not include defaults on WWI debt to United States and United Kingdom but includes post-1975 defaults on Official External Creditors`,
    exc_primary = `exch_primary source code`,
    domest_debt_default = `Domestic_Debt_In_Default`,
    domest_debt_notes = `Domestic_Debt_ Notes/Sources`,
    default_ext_notes = `Defaults_External_Notes`,
    gdp_weighted_default = `GDP_Weighted_default`,
    inflat_aver_consumer_prices = `Inflation, Annual percentages of average consumer prices`,
    curr_crises = `Currency Crises`,
    independence = `Independence`,
    inflat_crises = `Inflation Crises`
) %>%
  mutate(
    banking_crisis = as.logical(as.numeric(
      banking_crisis
      )),
    systemic_crisis = as.logical(as.numeric(
      systemic_crisis
    )),
    gold_standard = as.logical(as.numeric(
      gold_standard
    )),
    domest_debt_default = as.logical(as.numeric(
      domest_debt_default
    )),
    independence = as.logical(as.numeric(
      independence
    )),
    curr_crises = as.logical(as.numeric(
      curr_crises
    )),
    inflat_crises = as.logical(as.numeric(
      inflat_crises
    ))
  )
```

## Question 2: Hypothesis Testing

#### Was an economic crisis more likely following n years after decolonization?

Consider the following: for each country, we'll determine how many years after independence a country will typically experience its next crisis.
```{r independence}
output <- tibble(country = distinct(africa, country)$country)
output$independence_year <- africa %>%
  filter(independence == 1) %>%
  group_by(country) %>%
  filter(row_number()==1) %>%
  ungroup() %>%
  select(year)
  
output$crisis_year <- africa %>%
  filter(independence == 1) %>%
  group_by(country) %>%
  filter(banking_crisis == "crisis") %>%
  filter(row_number() == 1) %>%
  ungroup() %>%
  select(year)
output <- output %>%
  mutate(difference = (crisis_year$year - independence_year$year))
ggplot(data = output, mapping = aes(y = difference)) +
  geom_boxplot() + 
  labs(
    title = "What's the typical amount of years between a country 
    achieving independence and its next financial crisis?",
    y = "Number of Years")
output %>%
  summarise(IQR = IQR(difference), median = median(difference), mean = mean(difference))
```
We see that the median amount of years a country will first encounter a banking crisis after they achieve independence is about 30 years, with an interquartile range of 11 years and a mean of 31.3 years.

Importantly, we want to determine if the act of declaring independence quickens the onset of a systemic crisis, i.e. the number of years after independence for a country's next crisis is less than the average number of years to a country's next crisis. This is a hypothesis test for independence. 

Now, note that in general, the number of years between a crisis is X years - say, 28 years (actually calculate this).. 
PROBLEM: So, how do we calculate the average number of years to a country's next crisis. Do we just calculate each the number of years between every two crises, average them out, and halve them to get an average number of years to a country's next crisis?

#### Is there a difference between the GDP of African countries vs European countries in 2014?

And if so, what would be a confidence interval for an estimate of the difference in GDP?

```{r calc-avg-africa-europe-GDP}
gdps <- gdps %>%
  mutate(continent = countrycode(cc3, 'iso3c', 'continent')) %>%
  filter(continent %in% c('Africa', 'Europe'))
means <- gdps %>%
  group_by(continent) %>%
  drop_na(gdp) %>%
  summarise(mean = mean(gdp))
means
means %>% nth(2) %>% nth(2) - means %>% nth(2) %>% nth(1)
  
```
That's a $257746064282 difference in GDP. 

```{r africa-europe-GDP}
set.seed(1)


null_dist <- gdps %>%
  specify(response = gdp, explanatory = continent) %>%
  hypothesize(null = "independence") %>%
  generate(1000, type = "permute") %>%
  calculate(stat = "diff in medians", 
            order = c("Europe", "Africa"))
get_p_value(null_dist, obs_stat = 257746064282, direction = "two_sided")
```
P-value is 0.

Then, we'd calculate the confidence interval, but that's not too hard.

#### Is there a difference between GDP of North African and sub-Saharan African countries?

1. Label the countries
2. Calculate GDP diff. 
3. Do hypothesis testing.






